/*
 Navicat Premium Data Transfer

 Source Server         : project
 Source Server Type    : Oracle
 Source Server Version : 190000 (Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production)
 Source Host           : localhost:1521
 Source Schema         : RIDE

 Target Server Type    : Oracle
 Target Server Version : 190000 (Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production)
 File Encoding         : 65001

 Date: 31/08/2023 19:30:57
*/


-- ----------------------------
-- Table structure for AVAILABILITY
-- ----------------------------
DROP TABLE "RIDE"."AVAILABILITY";
CREATE TABLE "RIDE"."AVAILABILITY" (
  "D_ID" NUMBER VISIBLE NOT NULL,
  "IS_AVAILABLE" NUMBER VISIBLE,
  "LAST_UPDATED" TIMESTAMP(6) VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for DRIVER
-- ----------------------------
DROP TABLE "RIDE"."DRIVER";
CREATE TABLE "RIDE"."DRIVER" (
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73406".nextval NOT NULL,
  "NAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "PASSWORD" VARCHAR2(1024 BYTE) VISIBLE NOT NULL,
  "EMAIL" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "PHONE" VARCHAR2(20 BYTE) VISIBLE NOT NULL,
  "SEX" CHAR(1 BYTE) VISIBLE,
  "PLATE_NO" CHAR(20 BYTE) VISIBLE,
  "RATING" NUMBER VISIBLE DEFAULT 0,
  "WALLET_ID" NUMBER VISIBLE,
  "LAT" NUMBER VISIBLE,
  "LNG" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for MODEL
-- ----------------------------
DROP TABLE "RIDE"."MODEL";
CREATE TABLE "RIDE"."MODEL" (
  "NAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "V_TYPE" VARCHAR2(50 BYTE) VISIBLE NOT NULL,
  "MANUFACTURER" VARCHAR2(50 BYTE) VISIBLE NOT NULL
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for PAYMENTS
-- ----------------------------
DROP TABLE "RIDE"."PAYMENTS";
CREATE TABLE "RIDE"."PAYMENTS" (
  "TRANSACTION_NO" CHAR(20 BYTE) VISIBLE NOT NULL,
  "AMOUNT" NUMBER VISIBLE,
  "PAYMENT_TIME" TIMESTAMP(6) VISIBLE DEFAULT CURRENT_TIMESTAMP,
  "TR_ID" NUMBER VISIBLE,
  "PLAN_ID" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for PRICING_PLAN
-- ----------------------------
DROP TABLE "RIDE"."PRICING_PLAN";
CREATE TABLE "RIDE"."PRICING_PLAN" (
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73414".nextval NOT NULL,
  "BASE_FARE" NUMBER VISIBLE,
  "PER_DIST" NUMBER VISIBLE,
  "PER_MINUTE" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for REVIEW
-- ----------------------------
DROP TABLE "RIDE"."REVIEW";
CREATE TABLE "RIDE"."REVIEW" (
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73714".nextval NOT NULL,
  "RATING" NUMBER VISIBLE,
  "DESCRIPTION" VARCHAR2(1024 BYTE) VISIBLE,
  "TR_ID" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for RUNNING_TRIP
-- ----------------------------
DROP TABLE "RIDE"."RUNNING_TRIP";
CREATE TABLE "RIDE"."RUNNING_TRIP" (
  "TR_ID" NUMBER VISIBLE NOT NULL,
  "D_ID" NUMBER VISIBLE NOT NULL,
  "USERNAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "TIME_REQUEST" TIMESTAMP(6) VISIBLE,
  "START_TIME" TIMESTAMP(6) VISIBLE DEFAULT CURRENT_TIMESTAMP,
  "PLAT" NUMBER VISIBLE NOT NULL,
  "PLNG" NUMBER VISIBLE NOT NULL,
  "DLAT" NUMBER VISIBLE NOT NULL,
  "DLNG" NUMBER VISIBLE NOT NULL,
  "NOTIFIED" NUMBER VISIBLE DEFAULT 0,
  "FARE" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for TRIP_HISTORY
-- ----------------------------
DROP TABLE "RIDE"."TRIP_HISTORY";
CREATE TABLE "RIDE"."TRIP_HISTORY" (
  "TR_ID" NUMBER VISIBLE NOT NULL,
  "USERNAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "START_TIME" TIMESTAMP(6) VISIBLE NOT NULL,
  "FINISH_TIME" TIMESTAMP(6) VISIBLE,
  "REVIEW_ID" NUMBER VISIBLE,
  "PLATE_NO" CHAR(20 BYTE) VISIBLE NOT NULL,
  "PLAT" NUMBER VISIBLE,
  "PLNG" NUMBER VISIBLE,
  "DLAT" NUMBER VISIBLE,
  "DLNG" NUMBER VISIBLE,
  "FARE" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for TRIP_REQUEST
-- ----------------------------
DROP TABLE "RIDE"."TRIP_REQUEST";
CREATE TABLE "RIDE"."TRIP_REQUEST" (
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73597".nextval NOT NULL,
  "USERNAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "TIME_REQUEST" TIMESTAMP(6) VISIBLE DEFAULT CURRENT_TIMESTAMP,
  "PLAT" NUMBER VISIBLE,
  "PLNG" NUMBER VISIBLE,
  "DLAT" NUMBER VISIBLE,
  "DLNG" NUMBER VISIBLE,
  "V_TYPE" VARCHAR2(50 BYTE) VISIBLE,
  "FARE" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for USERS
-- ----------------------------
DROP TABLE "RIDE"."USERS";
CREATE TABLE "RIDE"."USERS" (
  "USERNAME" VARCHAR2(100 BYTE) VISIBLE NOT NULL,
  "PASSWORD" VARCHAR2(1024 BYTE) VISIBLE NOT NULL,
  "EMAIL" VARCHAR2(255 BYTE) VISIBLE NOT NULL,
  "PHONE" VARCHAR2(20 BYTE) VISIBLE NOT NULL,
  "SEX" CHAR(1 BYTE) VISIBLE,
  "IS_ADMIN" NUMBER VISIBLE NOT NULL,
  "WALLET_ID" NUMBER VISIBLE,
  "NAME" CHAR(100 BYTE) VISIBLE,
  "LAT" NUMBER VISIBLE,
  "LNG" NUMBER VISIBLE
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for VEHICLE
-- ----------------------------
DROP TABLE "RIDE"."VEHICLE";
CREATE TABLE "RIDE"."VEHICLE" (
  "PLATE_NO" CHAR(20 BYTE) VISIBLE NOT NULL,
  "MODELNAME" VARCHAR2(50 BYTE) VISIBLE NOT NULL,
  "PLAN_ID" NUMBER VISIBLE,
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73404".nextval NOT NULL
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Table structure for WALLET
-- ----------------------------
DROP TABLE "RIDE"."WALLET";
CREATE TABLE "RIDE"."WALLET" (
  "ID" NUMBER VISIBLE DEFAULT "RIDE"."ISEQ$$_73417".nextval NOT NULL,
  "BALANCE" NUMBER VISIBLE DEFAULT 0.0,
  "ACCOUNT_NO" NUMBER VISIBLE NOT NULL,
  "PASSWORD" VARCHAR2(1024 BYTE) VISIBLE NOT NULL
)
LOGGING
NOCOMPRESS
PCTFREE 10
INITRANS 1
STORAGE (
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1
  MAXEXTENTS 2147483645
  BUFFER_POOL DEFAULT
)
PARALLEL 1
NOCACHE
DISABLE ROW MOVEMENT
;

-- ----------------------------
-- Function structure for CONVERT_TO_GMT6
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."CONVERT_TO_GMT6" AS
BEGIN
    -- Convert to GMT+6 timezone
    converted_timestamp := input_timestamp AT TIME ZONE 'GMT' + INTERVAL '6' HOUR;

    -- Format the timestamp
    RETURN TO_CHAR(converted_timestamp, 'DD/MM/YYYY "at" HH:MI AM');
END;
/

-- ----------------------------
-- Function structure for DRIVER_AVAIL_INSERT
-- ----------------------------
CREATE OR REPLACE
PROCEDURE "RIDE"."DRIVER_AVAIL_INSERT" AS
BEGIN
	FOR R IN (SELECT ID FROM DRIVER WHERE NOT EXISTS(SELECT D_ID FROM AVAILABILITY WHERE D_ID=ID))
	LOOP
	INSERT INTO AVAILABILITY(D_ID,IS_AVAILABLE,LAST_UPDATED) VALUES(R.ID,0,CURRENT_TIMESTAMP);

	 
END LOOP;
END;
/

-- ----------------------------
-- Function structure for GENERATE_RANDOM_STRING
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."GENERATE_RANDOM_STRING" AS
BEGIN
    FOR i IN 1..13 LOOP
        random_string := random_string || SUBSTR(characters, CEIL(DBMS_RANDOM.VALUE(1, LENGTH(characters))), 1);
    END LOOP;
    
    RETURN random_string;
END generate_random_string;
/

-- ----------------------------
-- Function structure for GENERATE_TRANSACTION_NO
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."GENERATE_TRANSACTION_NO" AS
BEGIN
already:=0;
 str:=generate_random_string();
 SELECT COUNT(*) into already FROM PAYMENTS WHERE TRANSACTION_NO=str;
 
 if already=0 then return str;
 ELSE
	LOOP
	str:=generate_random_string();
 SELECT COUNT(*) into already FROM PAYMENTS WHERE TRANSACTION_NO=str;

	IF already=0 THEN
		return str; 
	END IF; 
END LOOP;

	
 end if;
 end;
/

-- ----------------------------
-- Function structure for GETPLATE
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."GETPLATE" AS
BEGIN
SELECT PLATE_NO into plt from driver WHERE id=did;
return plt;
END;
/

-- ----------------------------
-- Function structure for GETVTYPEBYID
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."GETVTYPEBYID" AS
BEGIN


SELECT UPPER(v_type) into typev from model 
WHERE name=
(
SELECT MODELNAME
from VEHICLE
WHERE
PLATE_NO=
(
SELECT PLATE_NO from DRIVER 
where id=did
)
);

return typev;

EXCEPTION
WHEN no_data_found THEN return 'NO_DATA_FOUND';
when others then return 'OTHERS';
END;
/

-- ----------------------------
-- Function structure for MAKE_TRANSACTION
-- ----------------------------
CREATE OR REPLACE
PROCEDURE "RIDE"."MAKE_TRANSACTION" AS
BEGIN
SELECT WALLET_ID into wd 
FROM DRIVER
 WHERE PLATE_NO=plate;
 
 SELECT WALLET_ID into wu 
 FROM USERS 
 WHERE USERNAME=usernam;
 paying(wu,wd,fare);
 END;
/

-- ----------------------------
-- Function structure for MODEL_DETAILS
-- ----------------------------
CREATE OR REPLACE
FUNCTION "RIDE"."MODEL_DETAILS" AS
BEGIN

SELECT MODELNAME into model_name from VEHICLE WHERE PLATE_NO=plate;


SELECT MANUFACTURER into company FROM MODEL WHERE name = model_name;

-- SELECT name into model_name,MANUFACTURER into company 
-- from MODEL
-- WHERE name=(SELECT MODELNAME from VEHICLE WHERE PLATE_NO=plate);

return company||' '||model_name;

EXCEPTION
when no_data_found then return 'NO_DATA_FOUND';
when others then return 'OTHERS';
END;
/

-- ----------------------------
-- Function structure for PAYING
-- ----------------------------
CREATE OR REPLACE
PROCEDURE "RIDE"."PAYING" AS
BEGIN

SELECT BALANCE into pu FROM WALLET WHERE id=wu;


SELECT BALANCE into pd FROM WALLET WHERE id=wd;

nu:=pu-fare;
nd:=pd+fare;

DBMS_OUTPUT.PUT_LINE(pu||' to '||nu ||',' || pd ||' to '|| nd);


UPDATE WALLET set BALANCE=nu WHERE ID=wu;
UPDATE WALLET set BALANCE=nd WHERE ID=wd;
DBMS_OUTPUT.PUT_LINE(pu||' to '||nu ||',' || pd ||' to '|| nd);	
	

END;
/

-- ----------------------------
-- Function structure for VEHICLE_UPDATE_MODEL
-- ----------------------------
CREATE OR REPLACE
PROCEDURE "RIDE"."VEHICLE_UPDATE_MODEL" AS
BEGIN

SELECT COUNT(*) INTO already from MODEL WHERE NAME=model_name;
IF already>0 THEN
	DBMS_OUTPUT.PUT_LINE('already ase');
ELSE 
		DBMS_OUTPUT.PUT_LINE('already nai');
		INSERT INTO MODEL(name,v_type,MANUFACTURER) VALUES(model_name,vtype,company);
		DBMS_OUTPUT.PUT_LINE('model insert done');
End if;
end;
/

-- ----------------------------
-- Sequence structure for ISEQ$$_73181
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73181";
CREATE SEQUENCE "RIDE"."ISEQ$$_73181" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73187
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73187";
CREATE SEQUENCE "RIDE"."ISEQ$$_73187" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73194
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73194";
CREATE SEQUENCE "RIDE"."ISEQ$$_73194" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73201
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73201";
CREATE SEQUENCE "RIDE"."ISEQ$$_73201" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73206
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73206";
CREATE SEQUENCE "RIDE"."ISEQ$$_73206" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73209
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73209";
CREATE SEQUENCE "RIDE"."ISEQ$$_73209" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73214
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73214";
CREATE SEQUENCE "RIDE"."ISEQ$$_73214" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73219
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73219";
CREATE SEQUENCE "RIDE"."ISEQ$$_73219" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73224
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73224";
CREATE SEQUENCE "RIDE"."ISEQ$$_73224" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73227
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73227";
CREATE SEQUENCE "RIDE"."ISEQ$$_73227" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73234
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73234";
CREATE SEQUENCE "RIDE"."ISEQ$$_73234" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73242
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73242";
CREATE SEQUENCE "RIDE"."ISEQ$$_73242" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73247
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73247";
CREATE SEQUENCE "RIDE"."ISEQ$$_73247" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73252
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73252";
CREATE SEQUENCE "RIDE"."ISEQ$$_73252" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73257
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73257";
CREATE SEQUENCE "RIDE"."ISEQ$$_73257" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73270
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73270";
CREATE SEQUENCE "RIDE"."ISEQ$$_73270" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73290
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73290";
CREATE SEQUENCE "RIDE"."ISEQ$$_73290" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73295
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73295";
CREATE SEQUENCE "RIDE"."ISEQ$$_73295" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73300
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73300";
CREATE SEQUENCE "RIDE"."ISEQ$$_73300" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73315
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73315";
CREATE SEQUENCE "RIDE"."ISEQ$$_73315" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73323
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73323";
CREATE SEQUENCE "RIDE"."ISEQ$$_73323" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73331
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73331";
CREATE SEQUENCE "RIDE"."ISEQ$$_73331" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73334
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73334";
CREATE SEQUENCE "RIDE"."ISEQ$$_73334" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73342
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73342";
CREATE SEQUENCE "RIDE"."ISEQ$$_73342" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73347
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73347";
CREATE SEQUENCE "RIDE"."ISEQ$$_73347" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73353
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73353";
CREATE SEQUENCE "RIDE"."ISEQ$$_73353" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73357
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73357";
CREATE SEQUENCE "RIDE"."ISEQ$$_73357" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73365
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73365";
CREATE SEQUENCE "RIDE"."ISEQ$$_73365" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73373
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73373";
CREATE SEQUENCE "RIDE"."ISEQ$$_73373" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73376
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73376";
CREATE SEQUENCE "RIDE"."ISEQ$$_73376" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73384
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73384";
CREATE SEQUENCE "RIDE"."ISEQ$$_73384" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73389
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73389";
CREATE SEQUENCE "RIDE"."ISEQ$$_73389" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73395
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73395";
CREATE SEQUENCE "RIDE"."ISEQ$$_73395" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73399
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73399";
CREATE SEQUENCE "RIDE"."ISEQ$$_73399" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73404
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73404";
CREATE SEQUENCE "RIDE"."ISEQ$$_73404" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73406
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73406";
CREATE SEQUENCE "RIDE"."ISEQ$$_73406" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73414
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73414";
CREATE SEQUENCE "RIDE"."ISEQ$$_73414" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73417
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73417";
CREATE SEQUENCE "RIDE"."ISEQ$$_73417" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73425
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73425";
CREATE SEQUENCE "RIDE"."ISEQ$$_73425" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73430
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73430";
CREATE SEQUENCE "RIDE"."ISEQ$$_73430" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73436
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73436";
CREATE SEQUENCE "RIDE"."ISEQ$$_73436" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73594
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73594";
CREATE SEQUENCE "RIDE"."ISEQ$$_73594" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73597
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73597";
CREATE SEQUENCE "RIDE"."ISEQ$$_73597" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Sequence structure for ISEQ$$_73714
-- ----------------------------
DROP SEQUENCE "RIDE"."ISEQ$$_73714";
CREATE SEQUENCE "RIDE"."ISEQ$$_73714" MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 CACHE 20;

-- ----------------------------
-- Primary Key structure for table AVAILABILITY
-- ----------------------------
ALTER TABLE "RIDE"."AVAILABILITY" ADD CONSTRAINT "AVAILABILITY_PK" PRIMARY KEY ("D_ID");

-- ----------------------------
-- Primary Key structure for table DRIVER
-- ----------------------------
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "DRIVER_PK" PRIMARY KEY ("ID");

-- ----------------------------
-- Uniques structure for table DRIVER
-- ----------------------------
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "DRIVER_WALLET_UK" UNIQUE ("WALLET_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008073" UNIQUE ("EMAIL") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008074" UNIQUE ("PHONE") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008075" UNIQUE ("PLATE_NO") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Checks structure for table DRIVER
-- ----------------------------
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "CHK_PHONE_FORMAT" CHECK (
    (TO_CHAR(phone) LIKE '88017%' OR
    TO_CHAR(phone) LIKE '88018%' OR
TO_CHAR(phone) LIKE '88016%' OR
TO_CHAR(phone) LIKE '88015%' OR
TO_CHAR(phone) LIKE '88013%' OR
TO_CHAR(phone) LIKE '88014%' OR
    TO_CHAR(phone) LIKE '88019%')
		AND (LENGTH(TO_CHAR(phone))=13)
) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "DRIVER_SEX_CHECK" CHECK (SEX in ('M', 'F')) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008064" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008065" CHECK ("NAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008066" CHECK ("PASSWORD" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008067" CHECK ("EMAIL" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "SYS_C008068" CHECK ("PHONE" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Triggers structure for table DRIVER
-- ----------------------------
CREATE TRIGGER "RIDE"."INSERT_DRIVER_AVAILABILITY" AFTER INSERT ON "RIDE"."DRIVER" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
  INSERT INTO availability (d_id, is_available,LAST_UPDATED)
  VALUES (:NEW.id, 1,CURRENT_TIMESTAMP);
END;
/

-- ----------------------------
-- Primary Key structure for table MODEL
-- ----------------------------
ALTER TABLE "RIDE"."MODEL" ADD CONSTRAINT "MODEL_PK" PRIMARY KEY ("NAME");

-- ----------------------------
-- Checks structure for table MODEL
-- ----------------------------
ALTER TABLE "RIDE"."MODEL" ADD CONSTRAINT "MODEL_TYPE_CHECK" CHECK (upper(V_TYPE) in('CAR','BIKE','CNG','MICROBUS')) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."MODEL" ADD CONSTRAINT "SYS_C008057" CHECK ("V_TYPE" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."MODEL" ADD CONSTRAINT "SYS_C008058" CHECK ("MANUFACTURER" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table PAYMENTS
-- ----------------------------
ALTER TABLE "RIDE"."PAYMENTS" ADD CONSTRAINT "PAYMENTS_PK" PRIMARY KEY ("TRANSACTION_NO");

-- ----------------------------
-- Uniques structure for table PAYMENTS
-- ----------------------------
ALTER TABLE "RIDE"."PAYMENTS" ADD CONSTRAINT "SYS_C008283" UNIQUE ("TR_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table PRICING_PLAN
-- ----------------------------
ALTER TABLE "RIDE"."PRICING_PLAN" ADD CONSTRAINT "PRICING_PLAN_PK" PRIMARY KEY ("ID");

-- ----------------------------
-- Checks structure for table PRICING_PLAN
-- ----------------------------
ALTER TABLE "RIDE"."PRICING_PLAN" ADD CONSTRAINT "SYS_C008080" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table REVIEW
-- ----------------------------
ALTER TABLE "RIDE"."REVIEW" ADD CONSTRAINT "REVIEW_PK" PRIMARY KEY ("ID");

-- ----------------------------
-- Uniques structure for table REVIEW
-- ----------------------------
ALTER TABLE "RIDE"."REVIEW" ADD CONSTRAINT "SYS_C008288" UNIQUE ("TR_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Checks structure for table REVIEW
-- ----------------------------
ALTER TABLE "RIDE"."REVIEW" ADD CONSTRAINT "SYS_C008286" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table RUNNING_TRIP
-- ----------------------------
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "RUNNING_TRIP_PK" PRIMARY KEY ("TR_ID", "D_ID");

-- ----------------------------
-- Checks structure for table RUNNING_TRIP
-- ----------------------------
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "SYS_C008258" CHECK ("USERNAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "SYS_C008259" CHECK ("PLAT" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "SYS_C008260" CHECK ("PLNG" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "SYS_C008261" CHECK ("DLAT" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "SYS_C008262" CHECK ("DLNG" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Triggers structure for table RUNNING_TRIP
-- ----------------------------
CREATE TRIGGER "RIDE"."TRG_RUNNING_TRIP_DELETE" BEFORE DELETE ON "RIDE"."RUNNING_TRIP" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
    UPDATE AVAILABILITY
    SET IS_AVAILABLE = 1, LAST_UPDATED = CURRENT_TIMESTAMP
    WHERE D_ID = :OLD.D_ID;
    
END;
/
CREATE TRIGGER "RIDE"."TRG_RUNNING_TRIP_INSERT" AFTER INSERT ON "RIDE"."RUNNING_TRIP" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
    UPDATE AVAILABILITY
    SET IS_AVAILABLE = 0, LAST_UPDATED = CURRENT_TIMESTAMP
    WHERE D_ID = :NEW.D_ID;
    
END;
/

-- ----------------------------
-- Primary Key structure for table TRIP_HISTORY
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "TRIP_HISTORY_PK" PRIMARY KEY ("TR_ID");

-- ----------------------------
-- Checks structure for table TRIP_HISTORY
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "SYS_C008275" CHECK ("USERNAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "SYS_C008276" CHECK ("START_TIME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "SYS_C008278" CHECK ("PLATE_NO" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Triggers structure for table TRIP_HISTORY
-- ----------------------------
CREATE TRIGGER "RIDE"."DELETERUNNING" AFTER INSERT ON "RIDE"."TRIP_HISTORY" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
    DELETE from RUNNING_TRIP WHERE TR_ID=:new.TR_ID;
END;
/
CREATE TRIGGER "RIDE"."MAKING_PAYMENT" AFTER INSERT ON "RIDE"."TRIP_HISTORY" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
    
		MAKE_TRANSACTION(:new.USERNAME,:new.PLATE_NO,:new.fare);
END;
/
CREATE TRIGGER "RIDE"."PAYMENTTABLEINSERT" AFTER INSERT ON "RIDE"."TRIP_HISTORY" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW 
BEGIN
    INSERT into PAYMENTS(TR_ID,AMOUNT,TRANSACTION_NO)
VALUES(:new.TR_ID,:new.FARE,generate_transaction_no());
		
END;
/

-- ----------------------------
-- Primary Key structure for table TRIP_REQUEST
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_REQUEST" ADD CONSTRAINT "TRIP_REQUEST_PK" PRIMARY KEY ("ID");

-- ----------------------------
-- Checks structure for table TRIP_REQUEST
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_REQUEST" ADD CONSTRAINT "SYS_C008218" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."TRIP_REQUEST" ADD CONSTRAINT "SYS_C008219" CHECK ("USERNAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table USERS
-- ----------------------------
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "USERS_PK" PRIMARY KEY ("USERNAME");

-- ----------------------------
-- Uniques structure for table USERS
-- ----------------------------
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008096" UNIQUE ("EMAIL") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008097" UNIQUE ("PHONE") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "USERS_WALLET_UK" UNIQUE ("WALLET_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Checks structure for table USERS
-- ----------------------------
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008087" CHECK ("USERNAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008088" CHECK ("PASSWORD" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008089" CHECK ("EMAIL" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008090" CHECK ("PHONE" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "SYS_C008091" CHECK ("IS_ADMIN" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "USERS_CHK_PHONE_FORMAT" CHECK (
    (TO_CHAR(phone) LIKE '88017%' OR
    TO_CHAR(phone) LIKE '88018%' OR
TO_CHAR(phone) LIKE '88016%' OR
TO_CHAR(phone) LIKE '88015%' OR
TO_CHAR(phone) LIKE '88013%' OR
TO_CHAR(phone) LIKE '88014%' OR
    TO_CHAR(phone) LIKE '88019%')
		AND (LENGTH(TO_CHAR(phone))=13)
) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "USERS_SEX_CHECK" CHECK (SEX in ('M', 'F')) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table VEHICLE
-- ----------------------------
ALTER TABLE "RIDE"."VEHICLE" ADD CONSTRAINT "VEHICLE_PK" PRIMARY KEY ("PLATE_NO");

-- ----------------------------
-- Checks structure for table VEHICLE
-- ----------------------------
ALTER TABLE "RIDE"."VEHICLE" ADD CONSTRAINT "SYS_C008061" CHECK ("MODELNAME" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."VEHICLE" ADD CONSTRAINT "SYS_C008135" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Primary Key structure for table WALLET
-- ----------------------------
ALTER TABLE "RIDE"."WALLET" ADD CONSTRAINT "WALLET_PK" PRIMARY KEY ("ID");

-- ----------------------------
-- Uniques structure for table WALLET
-- ----------------------------
ALTER TABLE "RIDE"."WALLET" ADD CONSTRAINT "SYS_C008086" UNIQUE ("ACCOUNT_NO") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Checks structure for table WALLET
-- ----------------------------
ALTER TABLE "RIDE"."WALLET" ADD CONSTRAINT "SYS_C008082" CHECK ("ID" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."WALLET" ADD CONSTRAINT "SYS_C008083" CHECK ("ACCOUNT_NO" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."WALLET" ADD CONSTRAINT "SYS_C008084" CHECK ("PASSWORD" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table AVAILABILITY
-- ----------------------------
ALTER TABLE "RIDE"."AVAILABILITY" ADD CONSTRAINT "AVAILABILITY_DRIVER_FK" FOREIGN KEY ("D_ID") REFERENCES "RIDE"."DRIVER" ("ID") ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table DRIVER
-- ----------------------------
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "DRIVER_VEHICLE_FK" FOREIGN KEY ("PLATE_NO") REFERENCES "RIDE"."VEHICLE" ("PLATE_NO") ON DELETE SET NULL NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."DRIVER" ADD CONSTRAINT "DRIVER_WALLET_FK" FOREIGN KEY ("WALLET_ID") REFERENCES "RIDE"."WALLET" ("ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table PAYMENTS
-- ----------------------------
ALTER TABLE "RIDE"."PAYMENTS" ADD CONSTRAINT "PAYMENTS_PLAN_FK" FOREIGN KEY ("PLAN_ID") REFERENCES "RIDE"."PRICING_PLAN" ("ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."PAYMENTS" ADD CONSTRAINT "PAYMENTS_TRIP_FK" FOREIGN KEY ("TR_ID") REFERENCES "RIDE"."TRIP_HISTORY" ("TR_ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table REVIEW
-- ----------------------------
ALTER TABLE "RIDE"."REVIEW" ADD CONSTRAINT "REVIEW_TRIPH_FK" FOREIGN KEY ("TR_ID") REFERENCES "RIDE"."TRIP_HISTORY" ("TR_ID") ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table RUNNING_TRIP
-- ----------------------------
ALTER TABLE "RIDE"."RUNNING_TRIP" ADD CONSTRAINT "RUNNING_TRIPS_DRIVER_FK" FOREIGN KEY ("D_ID") REFERENCES "RIDE"."DRIVER" ("ID") ON DELETE SET NULL NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table TRIP_HISTORY
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "TRIP_HISTORY_USERS_FK" FOREIGN KEY ("USERNAME") REFERENCES "RIDE"."USERS" ("USERNAME") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
ALTER TABLE "RIDE"."TRIP_HISTORY" ADD CONSTRAINT "TRIP_HISTORY_VEHICLE_FK" FOREIGN KEY ("PLATE_NO") REFERENCES "RIDE"."VEHICLE" ("PLATE_NO") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table TRIP_REQUEST
-- ----------------------------
ALTER TABLE "RIDE"."TRIP_REQUEST" ADD CONSTRAINT "TRIP_REQUEST_USERS_FK" FOREIGN KEY ("USERNAME") REFERENCES "RIDE"."USERS" ("USERNAME") ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table USERS
-- ----------------------------
ALTER TABLE "RIDE"."USERS" ADD CONSTRAINT "USER_WALLET_FK" FOREIGN KEY ("WALLET_ID") REFERENCES "RIDE"."WALLET" ("ID") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;

-- ----------------------------
-- Foreign Keys structure for table VEHICLE
-- ----------------------------
ALTER TABLE "RIDE"."VEHICLE" ADD CONSTRAINT "VEHICLE_MODEL_FK" FOREIGN KEY ("MODELNAME") REFERENCES "RIDE"."MODEL" ("NAME") NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;
